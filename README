This is a setup of an ELK-stack version 6.5 with Filebeat on separate virtual machines. Communication between Logstash and Filebeat servers is secured with ssl_certificates. In this setup the certificate authority is self generated.

Vagrantfile needs plugins hostmanager and disksize to be installed:
$ vagrant plugin install vagrant-hostmanager
$ vagrant plugin install vagrant-disksize

Example
CA authority:
$ openssl genrsa -des3 -out files/certs/myCA.key 2048
$ openssl req -x509 -new -nodes -key files/certs/myCA.key -sha256 -days 1825 -out files/certs/myCA.pem
Self signed certificate:
$ openssl genrsa -out files/certs/filebeat.key 2048
$ openssl req -new -key files/certs/filebeat.key -out files/certs/filebeat.csr
$ openssl x509 -req -in files/certs/filebeat.csr -CA files/certs/myCA.pem -CAkey files/certs/myCA.key -CAcreateserial -out files/certs/filebeat.crt -days 1825 -sha256
The CN of certificate must match the name of ELK host.

Files with the most essential parameters:
  - configurations for Vagrantfile are in vagrantfile.yaml
    - names and ip addresses of the machines
  - configurations for ansible setup are in elk.yml
    - name of hosts have to mach with vagrantfile.yaml hosts
 - roles/logstash/files/templates/kong_template.json for index    templating. Includes number of shards.
